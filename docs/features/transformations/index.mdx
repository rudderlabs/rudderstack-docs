---
title: "Transformations"
description: Write functions to transform your source data before sending it to your destinations.
---

RudderStack's **Transformations** feature lets you write custom functions to implement specific use-cases on your event data, like:

- Event filtering or sampling
- Data cleaning or aggregation
- Data masking or removing sensitive PII to ensure data privacy
- Enriching events by implementing static logic or leveraging an external API
- Using an API to implement specific actions on the events

<div class="successBlock">
RudderStack supports both JavaScript and Python to write your transformations.
</div>

You can use the Transformations feature across your <Link to="/sources/event-streams/">Event Streams</Link>, <Link to="/sources/extract/">Cloud Extract</Link>, and <Link to="/sources/reverse-etl/">Reverse ETL</Link> pipelines in both the cloud and device modes. For more information, refer to the <Link to="/features/transformations/cloud-mode-transformations">Cloud Mode Transformations</Link> and <Link to="/features/transformations/device-mode-transformations">Device Mode Transformations</Link> guides.

<YouTube
  videoId={'C11Na9oIv-E'}
/>

## Key features

- You can transform your events in real-time.
- Transformations easier to build, manage, and debug, and reuse.
- You can also programmatically add or remove the transformations using the <Link to="/api/transformation-api/">Transformations API</Link>.
- You can create an organization-wide sandbox where your team can store the transformations before publishing them in a production environment.
- You can version control your transformations.

Read more about why your data pipeline needs to have an efficient event transformations capability in the <a href="https://rudderstack.com/blog/the-future-of-data-pipeline-tools-must-include-better-transformations-than-etl-ever-had">RudderStack blog</a>.

## Use case

Suppose you want to set the `context.os` field to `Android` for all the events, irrespective of the actual platform RudderStack tracks the event from. To do this, you can write a simple transformation as shown:

```javascript
export function transformEvent(event, metadata) {
    event.context.os = { name: "Android"};
    return event;
}
```

The `transformEvent` function overrides the event's `context.os.name` and sets it as `Android`, as seen below:

<img src="../../assets/features/adding-a-transformation-3.png" alt="Transformation use-case" />

## Adding a transformation

To add a new transformation in the RudderStack dashboard, follow these steps:

1. Log in to the [RudderStack dashboard](https://app.rudderstack.com/).
2. Go to **Enhance** > **Transformations** and click **New Transformation**.
3. Name your transformation and an optional description.
4. Add your transformation function in the **Transformation** window, as shown:

<img src="../../assets/features/adding-a-transformation-2.png" alt="Adding a Transformation" />

<div class="successBlock">
You can also add other functions and call them from within <code class="inline-code">transformEvent</code>.
</div>

5. To test your transformation, click the **Run Test** button. By default, RudderStack provides a sample event payload to test if your transformation logic works as expected.

<img src="../../assets/features/adding-a-transformation-3.png" alt="Adding a Transformation" />

6. Finally, click **Save** to save the transformation.

## Connecting transformation to a destination

You can connect a transformation to a destination in two cases:

### Case 1: Setting up a new destination

You can connect an existing transformation or create a new transformation from scratch while setting up a destination, as shown:

<img src="../../assets/features/connecting-a-transformation.png" alt="Connecting a transformation" />

### Case 2: Connecting to an existing destination

1. In the dashboard, go to the **Transformation** tab and click **Add a transformation**, as shown:

<img src="../../assets/features/adding-transformation-existing-destination-1.png" alt="Connecting a transformation to existing destination" />

2. Select the transformation to connect to the destination and click **Choose**.

<img src="../../assets/features/adding-transformation-existing-destination-2.png" alt="Connecting a transformation to existing destination" />

## Deleting a transformation

<div class="warningBlock">
You cannot delete a transformation that is connected to a destination.
</div>

To delete a transformation, go to **Enhance** > **Transformations** and click the **Delete** button next to the transformation that you want to delete.

## `transformEvent` function

While using a transformation, RudderStack applies the `transformEvent` function on each event that takes two arguments:
- `event`: Corresponds to the input event.
- `metadata` (optional): Corresponds to the JavaScript function which you can use to access the metadata of the given event.

<div class="infoBlock">
For more information on <code class="inline-code">metadata</code>, refer to the <Link to="#accessing--the-event-metadata">Accessing metadata</Link> section below.
</div>

After the transformation is complete, `transformEvent` returns the final event to be sent to the destination.

## Accessing event metadata

RudderStack injects a function `metadata(event)` into your transformations as an argument. This allows you to access the event metadata variables that help you customize your transformations.

<div class="infoBlock">
<code class="inline-code">metadata()</code> takes the event as the input and returns the metadata of the event.
</div>

The following properties, if available, are present in the metadata response:

| Property   | Description       |
| :-------------- | :------------------------- |
| `sourceId`      | The source ID in the **Settings** tab of your configured source in the dashboard. |
| `destinationId` | The destination ID in the **Settings** tab of your configured destination in the dashboard.           |
| `messageId`     | The unique ID for each event.            |
| `sourceType` | The type of source, for example, Android, iOS, etc. |
| `destinationType` | The type of destination where RudderStack sends the transformed event, for example, Snowflake. | 

An example of using `metadata` is shown below:

```javascript
export function transformEvent(event, metadata) {
  const meta = metadata(event);
  event.sourceId = meta.sourceId;

  return event;
}
```

## Making external API requests

You can make any number of external API requests in your transformation functions and use the fetched responses to enrich your events. 

### JavaScript

RudderStack injects an asynchronous `fetch` function in your transformations. It makes an API call to the given URL and returns the response in the JSON format.

You can use the `fetch` function in your transformations, as shown:

```javascript
export async function transformEvent(event, metadata) {
  const res = await fetch("post_url", {
    method: "POST",  // POST, PUT, DELETE, GET, etc.
    headers: {
      "Content-Type": "application/json;charset=UTF-8",
      Authorization: "Bearer <authorization_token>"
    },
    body: JSON.stringify(event)
  });
  event.response = JSON.stringify(res);
  return event;
}
```

To see the <code class="inline-code">fetch</code> function in action, refer to the <a href="https://github.com/rudderlabs/sample-user-transformers/blob/sampleTransformationV1/EnrichWithClearbit.js">Clearbit enrichment</a> example.

<div class="infoBlock">
For improved performance, it is highly recommended to use the <code class="inline-code">batch</code> API requests wherever possible instead of a separate API request for each event.
</div>

#### `fetchV2`

`fetchv2` is a wrapper for the `fetch` call. It enables you to fetch the response properties more efficiently while making the external API calls.

The `fetchv2` response contains the following properties:

| Property | Description  |
| :-------------- | :----------- |
| `status`      | Status code of fetch response, for example, `200`. |
| `url` | The URL of the Fetch API.   |
| `headers`     | The response headers   |
| `body`     | The response body in JSON or TEXT. By default, it is JSON. |

The following example highlights the use of the `fetchV2` function in a transformation to capture failure due to a timeout: 
  
```javascript
export async function transformEvent(event) {
  try {
    const res = await fetchV2("url", { timeout: 1000});
    if (res.status == 200) {
      event.response = JSON.stringify(res.body);
    }
  } catch (err) {
    log(err.message);
  }
  return event;
}
```

### Python

Content to be added.

<br />