---
title: "Facebook Offline Conversions"
description: Step-by-step guide on sending your event data from RudderStack to Facebook Offline Conversions.
---

[Facebook Offline Conversions](https://www.facebook.com/business/help/1142103235885551?id=565900110447546) lets you measure your sales in the offline world as a result of your online Facebook ads. It helps you leverage the offline events data by tracking the in-store purchases, phone orders, bookings etc.

<div class="infoBlock">
Find the open source code for this destination in the <a href="https://github.com/rudderlabs/rudder-transformer/tree/master/v0/destinations/facebook_offline_conversions">GitHub repository</a>.
</div>

## Getting started

RudderStack supports sending event data to Facebook Offline Conversions via the following <a href="https://rudderstack.com/docs/rudderstack-cloud/rudderstack-connection-modes/">connection modes</a>:

| **Connection Mode** | **Web**       | **Mobile**    | **Server**    |
| :------------------ | :------------ | :------------ | :------------ |
| **Device mode**     | -             | -             | -             |
| **Cloud mode**      | -            | **Supported** | **Supported** |

Once you have confirmed that the source platform supports sending events to Facebook Offline Conversions, follow these steps:

1. From your [RudderStack dashboard](https://app.rudderstack.com/), add the source. Then, from the list of destinations, select **Facebook Offline Conversions**.
2. Assign a name to your destination and click **Continue**.

### Connection settings

To successfully configure Facebook Offline Conversions as a destination, you will need to configure the following settings:

- **System User Access Token**: Enter your system user access token generated inside Business Manager. with ads_management permission. Please add the corresponding developer app and ad account as asset.The system user needs to have admin permissions
- **Map your events with Facebook Standard Events**: Use this setting to map the standard Facebook events with custom event names. You can map one or more RudderStack events to a standard Facebook event but **not** vice-versa.
- **Map Facebook Standard Events With Event Set IDs**: Use this setting to map the standard Facebook events with Facebook event set ids. You can map one or more standard Facebook events to Facebook event set ids and vice-versa.

<div class="infoBlock">
If a Facebook standard event is mapped to more than one event set ID, RudderStack will send event for every event set ID.
</div>

- **Value Field Identifier**: Enter the identifier which should be assigned to the value field of Facebook payload. The default value is set to `properties.value`.
- **Limited Data Usage**: Enable this setting to let RudderStack take the data processing information from the payload and send it to Facebook.
- **Enable Hashing**: This setting is enabled by default and hash encodes the user data using `SHA256`.

<div class="infoBlock">
For more information on obtaining your Facebook Offline Conversions ID and Business Access Token, refer to the <a href="#faq">FAQ</a> section below.
</div>

## Track

You can use the <Link to="/event-spec/standard-events/track">`track`</Link> call to capture user events along with the properties associated with them.

<div class="infoBlock">
Keep in mind that Facebook’s furthest possible attribution window is 28 days. It is recommended that you send your server side track conversions within 62 days of the offline conversion occuring
</div>

The event name sent in the `track` call must be mapped in the **Map Facebook Standard Events With Event Set IDs** RudderStack dashboard setting, otherwise an error is thrown.

A sample `track` call is shown below:

```javascript
rudderanalytics.track({
  userId: 'user@1',
  event: 'Product Added',
  properties: {
    products: [{
      id: 1,
      category: 'Games',
      brand: 'Hasbro',
      price: 18.99,
      quantity: 1,
    }],
    order_id: 'cart1234',
    price: 18.99,
    currency: "USD"
  },
  traits: {
    email: 'test@rudderstack.com',
    phone: '4011234567',
    gender: 'm',
    firstName: 'test',
    lastName: "rudder",
    address: {
      city: 'Sitka',
      state: 'Alaska',
      postalCode: '99501',
      country: 'USA'
    }
  },
  context: {
    "dataProcessingOptions": [
      [
        "LDU"
      ],
      1,
      1000
    ],
  }
});
```

If your server has access to Facebook’s Lead IDs from their Lead Ads product, you can opt to send this using integration specific options. The `leadId` will come through `externalId`, as shown:

```javascript
"externalId": [{
  "id": "leadId-value",
  "type": "LeadId"
}, ],
```

Note the following points:

 - If you send a `products` array using `properties` object, make sure that every product contains only the `id`, `quantity`, `brand`, `category`, and `price` properties. Facebook will throw an error on encountering any property apart from these.
 - RudderStack sends a conversion event if it contains a `userId`. It is recommended to send as much user data through `context.traits` for better attribution results.
 - You can send either the `firstName` and `lastName` separately or just the `name` property. RudderStack maps it to `fn` and `ln` respectively.

### Property mappings

The following table lists the event property mappings between RudderStack and Facebook Offline Conversions:

| RudderStack property          | Facebook Offline Conversions property| Notes |
| :-------------------- | :---------------------- |:---------------------- |
| `userId` <br/>`traits.userId`<br/> `traits.id`<br/>`context.traits.userId`<br/>`context.traits.id`<br/>`anonymousId"` <br/> <span style="color: #4D4DFF;font-size:12px;">Required</span>| `extern_id`           |
| `originalTimestamp` <br/>`timestamp`  <br/> <span style="color: #4D4DFF;font-size:12px;">Required</span>   | `ViewContent`           |
| `event`   <br/> <span style="color: #4D4DFF;font-size:12px;">Required</span>    | `event_name`             |
| `properties.currency`   <br/> <span style="color: #4D4DFF;font-size:12px;">Required</span>  | `currency`              | If not provided, `USD` is used as the default value. |
| `properties.total`<br/>`properties.price`<br/>`properties.value`<br/>`properties.revenue` <br/> <span style="color: #4D4DFF;font-size:12px;">Required</span>  | `value` (currency value)                | If not provided, `0` is used as the default value. |
| `properties.item_number`    | `item_number`      |
|`properties.order_id`<br/>`properties.orderId`|`order_id`|
| `properties`     | `custom_data`           |
| `properties.products`       | `contents`             |
| `traits.email`<br/>`context.traits.email` <br/>`properties.email` <br/>`context.externalId.0.id`     | `email`              |
| `traits.phone`<br/>`context.traits.phone`<br/>`properties.phone`   | `phone`                |
| `traits.gender`<br/>`context.traits.gender`    | `gen`      |
|`traits.birthday`<br/>`context.traits.birthday`<br/>`traits.dateOfBirth`<br/>`context.traits.dateOfBirth`<br/>`traits.dateofbirth`<br/>`context.dateofbirth`<br/>`traits.dob`<br/>`context.traits.dob`<br/>`traits.DOB`<br/>`context.traits.DOB`|`doby`| The expected format is `DD, MM, YYYY`. RudderStack extracts the year, month and day before sending it to Facebook Offline Conversions. |
| `traits.firstName`<br/>`traits.firstname`<br/>`traits.first_name`<br/>`context.traits.firstName`<br/>`context.traits.firstname`<br/>`context.traits.first_name`    | `fn`      |
| `traits.lastName`<br/>`traits.lastname`<br/>`traits.last_name`<br/>`context.traits.lastName`<br/>`context.traits.lastname`<br/>`context.traits.last_name`    | `ln`      | 
|`traits.address.city`<br/>`context.traits.address.city`|`ct`|
| `traits.state`<br/>`context.traits.state`     | `st`           |
| `traits.zip`<br/>`traits.zipcode`<br/>`traits.zip_code`<br/>`traits.zipCode`<br/>`traits.postalcode`<br/>`traits.postal_code`<br/>`traits.postalCode`<br/>`traits.address.zipcode`<br/>`traits.address.zip_code`       | `zip`             |
| `traits.country`<br/>`context.traits.country`     | `country`           |
| `context.device.advertisingId`     | `madid`           |
| `context.userAgent`       | `client_user_agent`             |
| `traits.action_source`<br/>`context.traits.action_source`<br/>`properties.action_source`       | `action_source`             |
| `context.page.url`<br/>`properties.url`     | `event_source_url`           |
| `context.fbc`     | `fbc`           |
| `context.fbp`       | `fbp`             |

## FAQ

#### Where can I find the Business Access Token?

In order to use the Facebook Conversions API, you need to generate an access token. We recommend using the Facebook Events Manager to do so, by following these steps:

- Choose the relevant Facebook Offline Conversions and click on the **Settings** tab.
- In the Conversions API section, click on **Generate access token** under the **Set up manually** section, as shown:

<img src="../../assets/screen-shot-2021-03-03-at-1.44.33-pm.png" />

<div class="infoBlock">
For more information on how to use this access token or to generate your access token via your own app, refer to the <a href="https://developers.facebook.com/docs/marketing-api/conversions-api/get-started/#via-events-manager">Facebook documentation</a>.
</div>

#### How to manage permission for event sets

Refer to the [Facebook dcoumentation](https://www.facebook.com/business/help/629677790575687?id=565900110447546)


